imhere.MetroAPI=function(){this.consumer={consumerKey:"8e0dce63eacba7c35b6ae80c0aa5213385a3d03e04729c3f5926cb9ad8e060cf",datapointsUrl:"https://api.tokyometroapp.jp/api/v2/datapoints?",placeUrl:"https://api.tokyometroapp.jp/api/v2/places?"},this.trainName={"odpt.Railway:TokyoMetro.Chiyoda":"千代田線","odpt.Railway:TokyoMetro.Fukutoshin":"副都心線","odpt.Railway:TokyoMetro.Ginza":"銀座線","odpt.Railway:TokyoMetro.Hibiya":"日比谷線","odpt.Railway:TokyoMetro.Marunouchi":"丸ノ内線","odpt.Railway:TokyoMetro.Namboku":"南北線","odpt.Railway:TokyoMetro.Tozai":"東西線","odpt.Railway:TokyoMetro.Yurakucho":"有楽町線","odpt.Railway:TokyoMetro.Hanzomon":"半蔵門線"}},imhere.MetroAPI.prototype.getCurrentPosition=function(){var e=new $.Deferred;return navigator.geolocation.getCurrentPosition(function(t){e.resolve({latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy})},function(t){e.reject(t)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}),e.promise()},imhere.MetroAPI.prototype.getNearStation=function(e){var t=new $.Deferred;return this.getNearestStation(e,"1500",t)},imhere.MetroAPI.prototype.getNearestStation=function(e,t,r){var o,a;t!==a?(e.radius=t,o=r):(e.radius="200",o=new $.Deferred),e.type="odpt:Station";var n=imhere.MetroAPI.getPlaceUrl(this,e),i={type:"GET",url:n,success:function(e){var t="undefined";e.length>0&&(t={title:e[0]["dc:title"],lat:e[0]["geo:lat"],"long":e[0]["geo:long"],railway:e[0]["odpt:railway"],connectingrailway:e[0]["odpt:connectingRailway"],sameas:e[0]["owl:sameAs"]}),o.resolve(t)},error:function(e){o.reject(e)}};return $.ajax(i),o.promise()},imhere.MetroAPI.prototype.getLocationBetweenStations=function(e,t){var r=new $.Deferred;e.radius="2000",e.type="odpt:Station";var o=imhere.MetroAPI.getPlaceUrl(this,e),a={type:"GET",url:o,success:function(e){for(var o=[],a=0;a<e.length;a++)e[a]["odpt:railway"]===t.sameas&&o.push({title:e[a]["dc:title"],lat:e[a]["geo:lat"],"long":e[a]["geo:long"]});o.length<2&&(o="undefined"),r.resolve(o)},error:function(e){r.reject(e)}};return $.ajax(a),r.promise()},imhere.MetroAPI.prototype.getNearestExit=function(e){var t=new $.Deferred;e.radius="30",e.type="ug:Poi";var r=imhere.MetroAPI.getPlaceUrl(this,e),o={type:"GET",url:r,success:function(e){var r="undefined";e.length>0&&(r={title:e[0]["dc:title"],lat:e[0]["geo:lat"],"long":e[0]["geo:long"]}),t.resolve(r)},error:function(e){t.reject(e)}};return $.ajax(o),t.promise()},imhere.MetroAPI.prototype.getNearestRailway=function(e){var t=new $.Deferred;e.radius="150",e.type="odpt:Railway";var r=imhere.MetroAPI.getPlaceUrl(this,e),o={type:"GET",url:r,success:function(e){var r="undefined";e.length>0&&(r={title:e[0]["dc:title"],lat:e[0]["geo:lat"],"long":e[0]["geo:long"],sameas:e[0]["owl:sameAs"]}),t.resolve(r)},error:function(e){t.reject(e)}};return $.ajax(o),t.promise()},imhere.MetroAPI.prototype.getTrainInformation=function(e){var t,r=new $.Deferred,o={};o.type="odpt:TrainInformation";var a=e.sameas.replace("Branch","");o.condition={prop:"odpt:railway",value:a};var n=imhere.MetroAPI.getDataPointsUrl(this,o),i={type:"GET",url:n,success:function(e){var o="undefined";e.length>0&&(o={trainInformationText:e[0]["odpt:trainInformationStatus"]},o=o.trainInformationText===t?{trainInformationText:e[0]["odpt:trainInformationText"]}:{trainInformationText:e[0]["odpt:trainInformationStatus"]+"しています。"}),r.resolve(o)},error:function(e){r.reject(e)}};return $.ajax(i),r.promise()},imhere.MetroAPI.prototype.getRelatedTrainInformation=function(e){var t,r=new $.Deferred,o=this,a={};a.type="odpt:TrainInformation";var n=imhere.MetroAPI.getDataPointsUrl(this,a),i={type:"GET",url:n,success:function(a){var n=[];if(a.length>0){var i=e.connectingrailway;i.push(e.railway);for(var l=0;l<a.length;l++)for(var c={railway:a[l]["odpt:railway"],trainInformationText:a[l]["odpt:trainInformationText"],trainInformationStatus:a[l]["odpt:trainInformationStatus"]},u=0;u<i.length;u++){var s=i[u];s=s.replace("Branch",""),c.railway===s&&c.trainInformationStatus!==t&&n.push(o.trainName[c.railway]+"は、"+c.trainInformationStatus+"しています。")}}r.resolve(n)},error:function(e){r.reject(e)}};return $.ajax(i),r.promise()},imhere.MetroAPI.getPlaceUrl=function(e,t){return e.consumer.placeUrl+"rdf:type="+t.type+"&lon="+t.longitude+"&lat="+t.latitude+"&radius="+t.radius+"&acl:consumerKey="+e.consumer.consumerKey},imhere.MetroAPI.getDataPointsUrl=function(e,t){var r,o=e.consumer.datapointsUrl+"rdf:type="+t.type;return t.condition!==r&&(o=o+"&"+t.condition.prop+"="+t.condition.value),o=o+"&acl:consumerKey="+e.consumer.consumerKey};