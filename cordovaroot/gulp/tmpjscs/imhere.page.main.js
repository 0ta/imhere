imhere.MainPage=function(){var e=function(){var e=function(){imhere.utils.playAudio("main-main-imhere-music"),$("#main-main-imhere").addClass("animated rubberBand"),$("#main-main-imhere").bind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){n("main-main-imhere","rubberBand")})},t=function(e){$("#main-main-tweet-text").text(e),$("#main-main-tweet-text").addClass("animated fadeOut");var t=document.getElementById("main-main-tweet-text"),n=t.cloneNode(!0);t.parentNode.replaceChild(n,t),imhereglobalcontext.twitterAPI.updateStatus(e,"","").then(function(){},function(e){var t;if(e.responseText!==t){var n=JSON.parse(e.responseText);try{alertify.error(187==n.errors[0].code?"直近のTweetが同一位置データを参照しているため、このTweetは無効です":"予期せぬエラーのためTweetに失敗しました")}catch(e){alertify.error("予期せぬエラーのためTweetに失敗しました")}}else alertify.error("オフラインのためTweetに失敗しました")})},n=function(e,t){var n=document.getElementById(e);n.classList.remove("animated"),n.classList.remove(t);var i=n.cloneNode(!0);n.parentNode.replaceChild(i,n)};e();var i=new imhere.MetroAPI;i.getCurrentPosition().then(function(e){i.getNearestStation(e).then(function(n){"undefined"!==n?i.getNearestExit(e).then(function(a){t("undefined"!==a?n.title+"駅の"+a.title+"で待っています。誤差は最大"+imhere.utils.getAccuracyText(e.accuracy)+"です。<Lat:"+e.latitude+"/Long:"+e.longitude+"> "+IMHERE_HASHTAG+" ":n.title+"駅に到着しました。誤差は最大"+imhere.utils.getAccuracyText(e.accuracy)+"です。<Lat:"+e.latitude+"/Long:"+e.longitude+"> "+IMHERE_HASHTAG+" "),i.getRelatedTrainInformation(n).then(function(e){for(var t=0;t<e.length;t++)alertify.warning=alertify.extend("warning"),alertify.warning(e[t])},function(){alertify.error("オフラインのため処理に失敗しました")})},function(){alertify.error("オフラインのため処理に失敗しました")}):i.getNearestRailway(e).then(function(n){"undefined"!==n?i.getLocationBetweenStations(e,n).then(function(a){i.getTrainInformation(n).then(function(i){t(n.title+"線で"+a[0].title+"-"+a[1].title+"間を移動中です。"+n.title+"線は、"+i.trainInformationText+"誤差は最大"+imhere.utils.getAccuracyText(e.accuracy)+"です。<Lat:"+e.latitude+"/Long:"+e.longitude+"> "+IMHERE_HASHTAG+" ")},function(){alertify.error("オフラインのため処理に失敗しました")})},function(){alertify.error("オフラインのため処理に失敗しました")}):i.getNearStation(e).then(function(n){"undefined"!==n?(t("近くにMetroの駅はありません。最寄の駅は"+n.title+"になります。"+imhere.utils.geoDirection(e.latitude,e.longitude,n.lat,n.long)+"方向に"+imhere.utils.geoDistance(e.latitude,e.longitude,n.lat,n.long)+"m進んでください。誤差は最大"+imhere.utils.getAccuracyText(e.accuracy)+"です。<Lat:"+e.latitude+"/Long:"+e.longitude+"> "+IMHERE_HASHTAG+" "),i.getRelatedTrainInformation(n).then(function(e){for(var t=0;t<e.length;t++)alertify.warning=alertify.extend("warning"),alertify.warning(e[t])},function(){alertify.error("オフラインのため処理に失敗しました")})):t("Metro圏内にいません。∩(´･ω･`)つ―**:｡.:*ﾟ･* 誤差は最大"+imhere.utils.getAccuracyText(e.accuracy)+"です。<Lat:"+e.latitude+"/Long:"+e.longitude+"> "+IMHERE_HASHTAG+" ")},function(){alertify.error("オフラインのため処理に失敗しました")})},function(){alertify.error("オフラインのため処理に失敗しました")})},function(){alertify.error("オフラインのため処理に失敗しました")})},function(){alertify.error("位置情報が拾えませんでした")})},t=function(){alertify.set({labels:{ok:"Yes",cancel:"No"}}),alertify.set({buttonFocus:"ok"}),alertify.confirm("Do you want to log out？",function(e){if(e){var t=new imhere.IndexedDbAPI;t.openDB().then(function(){t.deleteToken("twitter").then(function(){imhereglobalcontext.twitterAPI.initAPI(),$.mobile.changePage("#logon_page",{transition:"none"})})})}})},n=function(){$.mobile.changePage("#googlemap_page",{transition:"none"})};return{initModule:function(){return $("#main-main-imhere-a").click(e),$("#main-header-logoff").click(t),$("#main-main-whereyourfriends-button").click(n),!0}}}();